(function(){"use strict";function x(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}const O=["id","name","modifiedTime","createdTime"],de=[...O,"thumbnailLink"];function D(e,t){if(typeof e=="object"){const s=e;return`https://www.googleapis.com/drive/v3/files?${new URLSearchParams(s)}`}const n=e;return t?`https://www.googleapis.com/drive/v3/files/${n}?${new URLSearchParams(t)}`:`https://www.googleapis.com/drive/v3/files/${n}`}function he(e,t){if(typeof e=="object"){const s=e;return`https://www.googleapis.com/upload/drive/v3/files?${new URLSearchParams(s)}`}const n=e;return t?`https://www.googleapis.com/upload/drive/v3/files/${n}?${new URLSearchParams(t)}`:`https://www.googleapis.com/upload/drive/v3/files/${n}`}function L(e){return new Headers({Authorization:`Bearer ${e}`})}async function ee(e,t){const n=D(e),s=await fetch(n,{method:"GET",headers:L(t)});if(s.status!==200)throw`googleFilesGetInternal unexpected status: ${s.status}`;return(await s.json()).files}async function pe(e,t,n){const s=e.split("/").filter(a=>a!==""),i=[];let r;for(let a=0;a<s.length;a++){let o=await ge(s[a],r,n);if(!o&&!t&&(o=await Xe(s[a],r,n)),r=o==null?void 0:o.id,i.push(o),!o)return i}return i}async function ze(e,t,n,s){const i=he({uploadType:"multipart",fields:O.join(",")}),r={name:t,mimeType:"image/png",parents:[e]},a=new FormData;a.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),a.append("file",n);const o=await fetch(i,{method:"POST",headers:L(s),body:a});if(o.status!==200)throw`googleFileCreate unexpected status: ${o.status}`;return await o.json()}async function F(e,t,n){return(await ee({q:`trashed=false and '${x(t)}' in parents and name='${x(e)}'`,fields:`nextPageToken, files(${de.join(",")})`},n))[0]}async function Ve(e,t){const n=D(e,{alt:"media"}),s=await fetch(n,{method:"GET",headers:L(t)});if(s.status!==200)throw`googleFileBlob unexpected status: ${s.status}`;return await s.blob()}async function qe(e,t,n,s){const i=he(e,{uploadType:"multipart",fields:O.join(",")}),r={name:t,mimeType:"image/png"},a=new FormData;a.append("metadata",new Blob([JSON.stringify(r)],{type:"application/json"})),a.append("file",n);const o=await fetch(i,{method:"PATCH",headers:L(s),body:a});if(o.status!==200)throw`googleFileUpdate unexpected status: ${o.status}`;return await o.json()}async function Je(e,t){const n=D(e),s=await fetch(n,{method:"DELETE",headers:L(t)});if(s.status!==204)throw`googleFileDelete unexpected status: ${s.status}`;return s.status===204}async function Ye(e,t){return await ee({q:`trashed=false and '${x(e)}' in parents`,fields:`nextPageToken, files(${de.join(",")})`},t)}async function Qe(e,t,n){const s=D({fields:O.join(",")}),i={name:e,parents:[t],mimeType:"application/vnd.google-apps.folder"},r=await fetch(s,{method:"POST",headers:L(n),body:JSON.stringify(i)});if(r.status!==200)throw`googleFolderCreate unexpected status: ${r.status}`;return await r.json()}async function ge(e,t,n){const s=t?` and '${x(t)}' in parents `:"";return(await ee({q:`trashed=false and name='${x(e)}' and mimeType='application/vnd.google-apps.folder' ${s}`,pageSize:"1",fields:`files(${O.join(",")})`},n))[0]}async function Xe(e,t,n){let s=await ge(e,t,n);return s||(s=await Qe(e,t,n)),s}async function Ze(e,t){return pe(e,!1,t)}async function te(e,t){return pe(e,!0,t)}let C;const ke=new Uint8Array(16);function et(){if(!C&&(C=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!C))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return C(ke)}const d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));function tt(e,t=0){return d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]}var _e={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function nt(e,t,n){if(_e.randomUUID&&!t&&!e)return _e.randomUUID();e=e||{};const s=e.random||(e.rng||et)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=s[i];return t}return tt(s)}function st(e){let t;const n={},s={subscribe:a,unsubscribe:o,publish:E,request:g,terminateWorker:j};return i(),s;function i(){return t||(t=r()),t}function r(){const c=e();return c.onmessage&&console.warn("onmessage was already bound"),c.onmessage=f=>{const p=n[f.data.name];if(!p){const v=`subscribers not found: ${f.data.name}`;console.error(v),f.data.callbackId&&s.publish(f.data.callbackId,[v,null])}p==null||p.forEach(async v=>{let fe,P;try{fe=await v(...f.data.params)}catch(k){P=k}f.data.callbackId&&s.publish(f.data.callbackId,[P,fe])})},c.onerror&&console.warn("onerror was already bound"),c.onerror=f=>{console.error(`worker error: ${f.message}`,f)},c}function a(c,f){n[c]||(n[c]=[]),n[c].push(f)}function o(c,f){n[c]||(n[c]=[]);const p=n[c].indexOf(f);p!==-1&&n[c].splice(p,1)}function g(c,f,p){const v=`callback:${nt()}`;return w({name:c,params:f,callbackId:v},p)}function E(c,f,p){w({name:c,params:f},p)}function w(c,f){return new Promise((p,v)=>{if(/^callback:/.test(c.name)||!c.callbackId)i().postMessage(c,f),p(void 0);else{const P=c.callbackId,k=(Ne,Wt)=>{if(o(P,k),Ne)return v(Ne);p(Wt)};a(P,k),i().postMessage({...c,callbackId:P},f)}})}function j(){t&&(t.onmessage=null,t.onerror=null,t.constructor.name==="Worker"&&t.terminate(),t=void 0)}}/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function it(e,t){const n=new Set(e.split(","));return t?s=>n.has(s.toLowerCase()):s=>n.has(s)}const rt=Object.prototype.hasOwnProperty,K=(e,t)=>rt.call(e,t),S=Array.isArray,A=e=>we(e)==="[object Map]",ot=e=>typeof e=="string",G=e=>typeof e=="symbol",B=e=>e!==null&&typeof e=="object",at=Object.prototype.toString,we=e=>at.call(e),lt=e=>we(e).slice(8,-1),ne=e=>ot(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,M=(e,t)=>!Object.is(e,t);/**
* @vue/reactivity v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ct;function ut(e,t=ct){t&&t.active&&t.effects.push(e)}let I;class ft{constructor(t,n,s,i){this.fn=t,this.trigger=n,this.scheduler=s,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,ut(this,i)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Se();for(let t=0;t<this._depsLength;t++){const n=this.deps[t];if(n.computed&&(dt(n.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Ie()}return this._dirtyLevel>=4}set dirty(t){this._dirtyLevel=t?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let t=m,n=I;try{return m=!0,I=this,this._runnings++,me(this),this.fn()}finally{be(this),this._runnings--,I=n,m=t}}stop(){var t;this.active&&(me(this),be(this),(t=this.onStop)==null||t.call(this),this.active=!1)}}function dt(e){return e.value}function me(e){e._trackId++,e._depsLength=0}function be(e){if(e.deps.length>e._depsLength){for(let t=e._depsLength;t<e.deps.length;t++)ye(e.deps[t],e);e.deps.length=e._depsLength}}function ye(e,t){const n=e.get(t);n!==void 0&&t._trackId!==n&&(e.delete(t),e.size===0&&e.cleanup())}let m=!0,se=0;const ve=[];function Se(){ve.push(m),m=!1}function Ie(){const e=ve.pop();m=e===void 0?!0:e}function ie(){se++}function re(){for(se--;!se&&oe.length;)oe.shift()()}function Te(e,t,n){if(t.get(e)!==e._trackId){t.set(e,e._trackId);const s=e.deps[e._depsLength];s!==t?(s&&ye(s,e),e.deps[e._depsLength++]=t):e._depsLength++}}const oe=[];function Re(e,t,n){ie();for(const s of e.keys()){let i;s._dirtyLevel<t&&(i??(i=e.get(s)===s._trackId))&&(s._shouldSchedule||(s._shouldSchedule=s._dirtyLevel===0),s._dirtyLevel=t),s._shouldSchedule&&(i??(i=e.get(s)===s._trackId))&&(s.trigger(),(!s._runnings||s.allowRecurse)&&s._dirtyLevel!==2&&(s._shouldSchedule=!1,s.scheduler&&oe.push(s.scheduler)))}re()}const Ee=(e,t)=>{const n=new Map;return n.cleanup=e,n.computed=t,n},ae=new WeakMap,T=Symbol(""),le=Symbol("");function _(e,t,n){if(m&&I){let s=ae.get(e);s||ae.set(e,s=new Map);let i=s.get(n);i||s.set(n,i=Ee(()=>s.delete(n))),Te(I,i)}}function b(e,t,n,s,i,r){const a=ae.get(e);if(!a)return;let o=[];if(t==="clear")o=[...a.values()];else if(n==="length"&&S(e)){const g=Number(s);a.forEach((E,w)=>{(w==="length"||!G(w)&&w>=g)&&o.push(E)})}else switch(n!==void 0&&o.push(a.get(n)),t){case"add":S(e)?ne(n)&&o.push(a.get("length")):(o.push(a.get(T)),A(e)&&o.push(a.get(le)));break;case"delete":S(e)||(o.push(a.get(T)),A(e)&&o.push(a.get(le)));break;case"set":A(e)&&o.push(a.get(T));break}ie();for(const g of o)g&&Re(g,4);re()}const ht=it("__proto__,__v_isRef,__isVue"),Le=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(G)),Me=pt();function pt(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const s=l(this);for(let r=0,a=this.length;r<a;r++)_(s,"get",r+"");const i=s[t](...n);return i===-1||i===!1?s[t](...n.map(l)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){Se(),ie();const s=l(this)[t].apply(this,n);return re(),Ie(),s}}),e}function gt(e){const t=l(this);return _(t,"has",e),t.hasOwnProperty(e)}class je{constructor(t=!1,n=!1){this._isReadonly=t,this._isShallow=n}get(t,n,s){const i=this._isReadonly,r=this._isShallow;if(n==="__v_isReactive")return!i;if(n==="__v_isReadonly")return i;if(n==="__v_isShallow")return r;if(n==="__v_raw")return s===(i?r?Mt:Fe:r?Lt:De).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(s)?t:void 0;const a=S(t);if(!i){if(a&&K(Me,n))return Reflect.get(Me,n,s);if(n==="hasOwnProperty")return gt}const o=Reflect.get(t,n,s);return(G(n)?Le.has(n):ht(n))||(i||_(t,"get",n),r)?o:Q(o)?a&&ne(n)?o:o.value:B(o)?i?Ke(o):Ce(o):o}}class _t extends je{constructor(t=!1){super(!1,t)}set(t,n,s,i){let r=t[n];if(!this._isShallow){const g=J(r);if(!Ge(s)&&!J(s)&&(r=l(r),s=l(s)),!S(t)&&Q(r)&&!Q(s))return g?!1:(r.value=s,!0)}const a=S(t)&&ne(n)?Number(n)<t.length:K(t,n),o=Reflect.set(t,n,s,i);return t===l(i)&&(a?M(s,r)&&b(t,"set",n,s):b(t,"add",n,s)),o}deleteProperty(t,n){const s=K(t,n);t[n];const i=Reflect.deleteProperty(t,n);return i&&s&&b(t,"delete",n,void 0),i}has(t,n){const s=Reflect.has(t,n);return(!G(n)||!Le.has(n))&&_(t,"has",n),s}ownKeys(t){return _(t,"iterate",S(t)?"length":T),Reflect.ownKeys(t)}}class wt extends je{constructor(t=!1){super(!0,t)}set(t,n){return!0}deleteProperty(t,n){return!0}}const mt=new _t,bt=new wt,ce=e=>e,W=e=>Reflect.getPrototypeOf(e);function H(e,t,n=!1,s=!1){e=e.__v_raw;const i=l(e),r=l(t);n||(M(t,r)&&_(i,"get",t),_(i,"get",r));const{has:a}=W(i),o=s?ce:n?ue:$;if(a.call(i,t))return o(e.get(t));if(a.call(i,r))return o(e.get(r));e!==i&&e.get(t)}function N(e,t=!1){const n=this.__v_raw,s=l(n),i=l(e);return t||(M(e,i)&&_(s,"has",e),_(s,"has",i)),e===i?n.has(e):n.has(e)||n.has(i)}function z(e,t=!1){return e=e.__v_raw,!t&&_(l(e),"iterate",T),Reflect.get(e,"size",e)}function Pe(e){e=l(e);const t=l(this);return W(t).has.call(t,e)||(t.add(e),b(t,"add",e,e)),this}function xe(e,t){t=l(t);const n=l(this),{has:s,get:i}=W(n);let r=s.call(n,e);r||(e=l(e),r=s.call(n,e));const a=i.call(n,e);return n.set(e,t),r?M(t,a)&&b(n,"set",e,t):b(n,"add",e,t),this}function Oe(e){const t=l(this),{has:n,get:s}=W(t);let i=n.call(t,e);i||(e=l(e),i=n.call(t,e)),s&&s.call(t,e);const r=t.delete(e);return i&&b(t,"delete",e,void 0),r}function $e(){const e=l(this),t=e.size!==0,n=e.clear();return t&&b(e,"clear",void 0,void 0),n}function V(e,t){return function(s,i){const r=this,a=r.__v_raw,o=l(a),g=t?ce:e?ue:$;return!e&&_(o,"iterate",T),a.forEach((E,w)=>s.call(i,g(E),g(w),r))}}function q(e,t,n){return function(...s){const i=this.__v_raw,r=l(i),a=A(r),o=e==="entries"||e===Symbol.iterator&&a,g=e==="keys"&&a,E=i[e](...s),w=n?ce:t?ue:$;return!t&&_(r,"iterate",g?le:T),{next(){const{value:j,done:c}=E.next();return c?{value:j,done:c}:{value:o?[w(j[0]),w(j[1])]:w(j),done:c}},[Symbol.iterator](){return this}}}}function y(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function yt(){const e={get(r){return H(this,r)},get size(){return z(this)},has:N,add:Pe,set:xe,delete:Oe,clear:$e,forEach:V(!1,!1)},t={get(r){return H(this,r,!1,!0)},get size(){return z(this)},has:N,add:Pe,set:xe,delete:Oe,clear:$e,forEach:V(!1,!0)},n={get(r){return H(this,r,!0)},get size(){return z(this,!0)},has(r){return N.call(this,r,!0)},add:y("add"),set:y("set"),delete:y("delete"),clear:y("clear"),forEach:V(!0,!1)},s={get(r){return H(this,r,!0,!0)},get size(){return z(this,!0)},has(r){return N.call(this,r,!0)},add:y("add"),set:y("set"),delete:y("delete"),clear:y("clear"),forEach:V(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=q(r,!1,!1),n[r]=q(r,!0,!1),t[r]=q(r,!1,!0),s[r]=q(r,!0,!0)}),[e,n,t,s]}const[vt,St,It,Tt]=yt();function Ue(e,t){const n=t?e?Tt:It:e?St:vt;return(s,i,r)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?s:Reflect.get(K(n,i)&&i in s?n:s,i,r)}const Rt={get:Ue(!1,!1)},Et={get:Ue(!0,!1)},De=new WeakMap,Lt=new WeakMap,Fe=new WeakMap,Mt=new WeakMap;function jt(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Pt(e){return e.__v_skip||!Object.isExtensible(e)?0:jt(lt(e))}function Ce(e){return J(e)?e:Ae(e,!1,mt,Rt,De)}function Ke(e){return Ae(e,!0,bt,Et,Fe)}function Ae(e,t,n,s,i){if(!B(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=i.get(e);if(r)return r;const a=Pt(e);if(a===0)return e;const o=new Proxy(e,a===2?s:n);return i.set(e,o),o}function J(e){return!!(e&&e.__v_isReadonly)}function Ge(e){return!!(e&&e.__v_isShallow)}function l(e){const t=e&&e.__v_raw;return t?l(t):e}const $=e=>B(e)?Ce(e):e,ue=e=>B(e)?Ke(e):e;class xt{constructor(t,n,s,i){this.getter=t,this._setter=n,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new ft(()=>t(this._value),()=>Y(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=s}get value(){const t=l(this);return(!t._cacheable||t.effect.dirty)&&M(t._value,t._value=t.effect.run())&&Y(t,4),Be(t),t.effect._dirtyLevel>=2&&Y(t,2),t._value}set value(t){this._setter(t)}get _dirty(){return this.effect.dirty}set _dirty(t){this.effect.dirty=t}}function Be(e){var t;m&&I&&(e=l(e),Te(I,(t=e.dep)!=null?t:e.dep=Ee(()=>e.dep=void 0,e instanceof xt?e:void 0)))}function Y(e,t=4,n){e=l(e);const s=e.dep;s&&Re(s,t)}function Q(e){return!!(e&&e.__v_isRef===!0)}function Ot(e){return $t(e,!1)}function $t(e,t){return Q(e)?e:new Ut(e,t)}class Ut{constructor(t,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?t:l(t),this._value=n?t:$(t)}get value(){return Be(this),this._value}set value(t){const n=this.__v_isShallow||Ge(t)||J(t);t=n?t:l(t),M(t,this._rawValue)&&(this._rawValue=t,this._value=n?t:$(t),Y(this,4))}}let We;const X=Ot(He());function He(){return{progress:{steps:0,complete:0,message:"",error:!1,visible:!1,percent:"0%"},toast:{message:"",error:!1,visible:!1}}}function Dt(){Object.assign(X.value,He()),clearInterval(We),We=void 0}function Ft(e){console.log("toast:",e),Dt(),X.value.toast.message=e,X.value.toast.visible=!0,setTimeout(()=>X.value.toast.visible=!1,5e3)}const R=st(()=>self);R.subscribe("saveBlob",At),R.subscribe("loadBlob",Kt),R.subscribe("setAccessToken",Ct),R.subscribe("loadGallery",Bt),R.subscribe("deleteArtwork",Gt);let u;const Z="gallery.challen.info/v2";async function Ct(e){Ft("onSetAccessToken len:"+(u==null?void 0:u.length)),console.log("onSetAccessToken",(e||"").substring(0,6)+"..."),u=e}const U=e=>R.publish("notifyError",[e]),h=(e,t)=>R.publish("notifyProgress",[e,t]);async function Kt(e){if(!u)throw"accessToken not set";h("finding folders",3);const t=await te(Z+"/"+e.path,u),n=t[t.length-1];if(!n)return U("folder not found");h("finding file");const s=await F(e.name,n.id,u);if(!s)return U("file not found");h("loading file");const i=await Ve(s.id,u);return h("file loaded"),i}async function At(e){if(!u)throw"accessToken not set";h("finding folders",4);const t=await Ze(Z+"/"+e.path,u),n=t[t.length-1];if(!n)return U("folder not found");h("finding file");let s=await F(e.name,n.id,u);h("saving file"),s?s=await qe(s.id,e.name,e.blob,u):s=await ze(n.id,e.name,e.blob,u),h("get file");const i=await F(s.name,n.id,u);if(console.log(i),h("file saved"),!!i)return{id:i.id,name:i.name,createdTime:new Date(i.createdTime),modifiedTime:new Date(i.modifiedTime),thumbnailUrl:i.thumbnailLink}}async function Gt(e){if(!u)throw"accessToken not set";h("finding folders",3);const t=await te(Z+"/"+e.path,u),n=t[t.length-1];if(!n)return U("folder not found");h("finding file");const s=await F(e.name,n.id,u);s?(h("deleting file"),await Je(s.id,u),h("deleted")):h("file did not exist",-2)}async function Bt(e){if(!u)throw"accessToken not set";h("finding folders",2);const t=await te(Z+"/"+e,u),n=t[t.length-1];if(!n)return U("folder not found");h("finding files");const s=await Ye(n.id,u);return h("files loaded"),s.map(i=>({id:i.id,name:i.name,createdTime:new Date(i.createdTime),modifiedTime:new Date(i.modifiedTime),thumbnailUrl:i.thumbnailLink}))}})();
//# sourceMappingURL=GalleryWorker-COdQ8t_H.js.map
